# ğŸ”¥ æ€§èƒ½é—®é¢˜åˆ†ææŠ¥å‘Š

## ğŸ“Š ä¸¥é‡æ€§è¯„ä¼°
- **å‘çƒ­ç¨‹åº¦**: âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸ ä¸¥é‡
- **è€—ç”µç¨‹åº¦**: âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸ ä¸¥é‡
- **å¡é¡¿ç¨‹åº¦**: âš ï¸âš ï¸âš ï¸âš ï¸ ä¸­ç­‰åä¸¥é‡

---

## ğŸ” ä¸»è¦æ€§èƒ½ç“¶é¢ˆ

### 1. â±ï¸ **é«˜é¢‘ç‡ Timer (æœ€ä¸¥é‡)**
**ä½ç½®**: `JourneyManager.swift:285`
```swift
timer = Timer.scheduledTimer(withTimeInterval: 0.5, repeats: true)
```
**é—®é¢˜**: 
- æ¯ 0.5 ç§’è§¦å‘ä¸€æ¬¡ï¼Œé¢‘ç‡è¿‡é«˜
- æ¯æ¬¡è§¦å‘éƒ½ä¼šè°ƒç”¨ `updateJourney()` å’Œ `checkForPOIs()`
- å¯¼è‡´æŒç»­çš„ CPU å ç”¨

**å½±å“**: ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ æé«˜
**å»ºè®®**: æ”¹ä¸º 2-3 ç§’é—´éš”

---

### 2. ğŸ—ºï¸ **MapKit è¿‡åº¦è¯·æ±‚ (ä¸¥é‡)**
**ä½ç½®**: `JourneyManager.swift:308-350`
```swift
private let poiCheckInterval: TimeInterval = 120 // æ¯ 120 ç§’
private let discoveryRadius: CLLocationDistance = 100
```
**é—®é¢˜**:
- æ¯ 120 ç§’æ‰§è¡Œ 3 æ¬¡ MapKit æœç´¢ï¼ˆrestaurant, landmark, parkï¼‰
- æ¯æ¬¡æœç´¢åŠå¾„ 100 ç±³ï¼Œä½†å®é™…æœç´¢èŒƒå›´æ˜¯ 200x200 ç±³
- æ¯ä¸ªæŸ¥è¯¢ä¹‹é—´åªå»¶è¿Ÿ 0.5 ç§’ï¼Œå®¹æ˜“è§¦å‘é™æµ
- é¢‘ç¹çš„ç½‘ç»œè¯·æ±‚å’Œæ•°æ®å¤„ç†

**å½±å“**: ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ æé«˜
**å»ºè®®**: 
- å¢åŠ é—´éš”åˆ° 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰
- å‡å°‘æŸ¥è¯¢ç±»å‹åˆ° 1-2 ä¸ª
- å¢åŠ å»¶è¿Ÿåˆ° 2 ç§’

---

### 3. ğŸ¨ **è¿‡å¤šçš„æŒç»­åŠ¨ç”» (ä¸¥é‡)**

#### 3.1 åœ°å›¾è„‰å†²åŠ¨ç”»
**ä½ç½®**: `ExplorationMapView.swift:145-148`
```swift
withAnimation(.easeInOut(duration: 1.5).repeatForever(autoreverses: true)) {
    pulseScale = 1.3
}
```
**å½±å“**: ğŸ”¥ğŸ”¥ğŸ”¥ ä¸­ç­‰

#### 3.2 å¤©æ°”èƒŒæ™¯åŠ¨ç”»
**ä½ç½®**: `WeatherBackgroundView.swift`
- æ¸å˜åŠ¨ç”»ï¼ˆ20 ç§’å¾ªç¯ï¼‰
- äº‘æœµåŠ¨ç”»ï¼ˆ35-40 ç§’å¾ªç¯ï¼‰
- æ˜Ÿæ˜Ÿé—ªçƒï¼ˆ3 ç§’å¾ªç¯ï¼‰
- é›¨æ»´åŠ¨ç”»ï¼ˆ15 ä¸ªç‹¬ç«‹åŠ¨ç”»ï¼‰
- é›ªèŠ±åŠ¨ç”»ï¼ˆ20 ä¸ªç‹¬ç«‹åŠ¨ç”»ï¼‰

**å½±å“**: ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ é«˜
**å»ºè®®**: å‡å°‘ç²’å­æ•°é‡ï¼Œé™ä½åŠ¨ç”»å¸§ç‡

#### 3.3 æŒ‰é’®å‘¼å¸åŠ¨ç”»
**ä½ç½®**: `SetupView.swift:530`
```swift
withAnimation(.easeInOut(duration: 1.5).repeatForever(autoreverses: true)) {
    buttonGlow = 1.0
}
```
**å½±å“**: ğŸ”¥ ä½

#### 3.4 Onboarding åŠ¨ç”»
**ä½ç½®**: `OnboardingView.swift`
- å¤šä¸ª `repeatForever` åŠ¨ç”»åŒæ—¶è¿è¡Œ
- æµ®åŠ¨å›¾æ ‡ã€æ—‹è½¬ã€ç¼©æ”¾ç­‰

**å½±å“**: ğŸ”¥ğŸ”¥ ä¸­ç­‰

---

### 4. ğŸ¯ **åœ°å›¾å®æ—¶æ›´æ–° (ä¸¥é‡)**
**ä½ç½®**: `ExplorationMapView.swift:150-165`
```swift
private func startSpeedUpdateTimer() {
    Timer.scheduledTimer(withTimeInterval: 3.0, repeats: true) { _ in
        updateSpeed()
    }
}
```
**é—®é¢˜**:
- æ¯ 3 ç§’æ›´æ–°é€Ÿåº¦
- æ¯æ¬¡æ›´æ–°éƒ½è§¦å‘åœ°å›¾é‡ç»˜
- ç›¸æœºä½ç½®æ¯ 1 ç§’æ›´æ–°ä¸€æ¬¡ï¼ˆlinear åŠ¨ç”»ï¼‰

**å½±å“**: ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ é«˜

---

### 5. ğŸ“ **GPS æŒç»­å®šä½ (ä¸­ç­‰)**
**ä½ç½®**: `LocationManager.swift:35`
```swift
locationManager.desiredAccuracy = kCLLocationAccuracyBest
locationManager.distanceFilter = 10 // æ¯ 10 ç±³æ›´æ–°
```
**é—®é¢˜**:
- ä½¿ç”¨æœ€é«˜ç²¾åº¦å®šä½
- é¢‘ç¹çš„ä½ç½®æ›´æ–°

**å½±å“**: ğŸ”¥ğŸ”¥ğŸ”¥ ä¸­ç­‰
**å»ºè®®**: 
- æ”¹ä¸º `kCLLocationAccuracyHundredMeters`
- å¢åŠ  `distanceFilter` åˆ° 50 ç±³

---

### 6. ğŸ­ **è¿‡åº¦ä½¿ç”¨ Material æ•ˆæœ**
**ä½ç½®**: å¤šå¤„ä½¿ç”¨ `.ultraThinMaterial`
- æ¯ä¸ªå¡ç‰‡éƒ½ä½¿ç”¨æ¯›ç»ç’ƒæ•ˆæœ
- å®æ—¶æ¨¡ç³Šéœ€è¦å¤§é‡ GPU è®¡ç®—

**å½±å“**: ğŸ”¥ğŸ”¥ğŸ”¥ ä¸­ç­‰

---

### 7. ğŸ”„ **é¢‘ç¹çš„è§†å›¾åˆ·æ–°**
**ä½ç½®**: `SetupView.swift`
```swift
@State private var refreshID = UUID()
.onChange(of: settings.selectedLanguage) { _, _ in
    refreshID = UUID()
}
```
**é—®é¢˜**: è¯­è¨€åˆ‡æ¢æ—¶é‡å»ºæ•´ä¸ªè§†å›¾æ ‘

**å½±å“**: ğŸ”¥ğŸ”¥ ä¸­ç­‰

---

## ğŸ“ˆ æ€§èƒ½å½±å“æ’å

1. **JourneyManager Timer (0.5s)** - ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ æé«˜
2. **MapKit POI æœç´¢** - ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ æé«˜
3. **åœ°å›¾å®æ—¶æ›´æ–°** - ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ é«˜
4. **å¤©æ°”èƒŒæ™¯åŠ¨ç”»** - ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ é«˜
5. **GPS é«˜ç²¾åº¦å®šä½** - ğŸ”¥ğŸ”¥ğŸ”¥ ä¸­ç­‰
6. **Material æ•ˆæœ** - ğŸ”¥ğŸ”¥ğŸ”¥ ä¸­ç­‰
7. **åœ°å›¾è„‰å†²åŠ¨ç”»** - ğŸ”¥ğŸ”¥ğŸ”¥ ä¸­ç­‰
8. **æŒ‰é’®åŠ¨ç”»** - ğŸ”¥ ä½

---

## ğŸ¯ ä¼˜åŒ–å»ºè®®ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### ğŸš¨ ç´§æ€¥ä¼˜åŒ–ï¼ˆç«‹å³æ‰§è¡Œï¼‰

1. **é™ä½ Timer é¢‘ç‡**
   - JourneyManager: 0.5s â†’ 2.0s
   - SpeedUpdate: 3.0s â†’ 5.0s

2. **å‡å°‘ MapKit è¯·æ±‚**
   - POI æ£€æŸ¥é—´éš”: 120s â†’ 300s
   - æŸ¥è¯¢ç±»å‹: 3 ä¸ª â†’ 1 ä¸ª
   - è¯·æ±‚å»¶è¿Ÿ: 0.5s â†’ 2.0s

3. **é™ä½ GPS ç²¾åº¦**
   - ç²¾åº¦: Best â†’ HundredMeters
   - è·ç¦»è¿‡æ»¤: 10m â†’ 50m

### âš ï¸ é‡è¦ä¼˜åŒ–ï¼ˆå°½å¿«æ‰§è¡Œï¼‰

4. **ç®€åŒ–å¤©æ°”åŠ¨ç”»**
   - é›¨æ»´: 15 ä¸ª â†’ 5 ä¸ª
   - é›ªèŠ±: 20 ä¸ª â†’ 8 ä¸ª
   - æ˜Ÿæ˜Ÿ: 15 ä¸ª â†’ 8 ä¸ª
   - ç§»é™¤äº‘æœµåŠ¨ç”»æˆ–é™ä½é¢‘ç‡

5. **ä¼˜åŒ–åœ°å›¾æ›´æ–°**
   - å‡å°‘ç›¸æœºæ›´æ–°é¢‘ç‡
   - ä½¿ç”¨ `drawingGroup()` åˆå¹¶æ¸²æŸ“
   - å‡å°‘ POI æ ‡è®°æ•°é‡

6. **å‡å°‘ Material ä½¿ç”¨**
   - éƒ¨åˆ†å¡ç‰‡æ”¹ç”¨çº¯è‰²èƒŒæ™¯
   - é™ä½æ¨¡ç³Šå¼ºåº¦

### ğŸ’¡ å»ºè®®ä¼˜åŒ–ï¼ˆæœ‰æ—¶é—´æ‰§è¡Œï¼‰

7. **ä¼˜åŒ–åŠ¨ç”»**
   - ç§»é™¤ä¸å¿…è¦çš„ `repeatForever` åŠ¨ç”»
   - ä½¿ç”¨ CADisplayLink æ›¿ä»£ Timer
   - å®ç°åŠ¨ç”»æš‚åœæœºåˆ¶

8. **å®ç°æ‡’åŠ è½½**
   - å†å²è®°å½•åˆ†é¡µåŠ è½½
   - åœ°å›¾æ ‡è®°æŒ‰éœ€æ˜¾ç¤º

9. **ç¼“å­˜ä¼˜åŒ–**
   - ç¼“å­˜å¤©æ°”æ•°æ®
   - ç¼“å­˜åœ°å›¾è·¯çº¿
   - ç¼“å­˜ POI æœç´¢ç»“æœ

---

## ğŸ“Š é¢„æœŸæ”¹å–„

å®æ–½æ‰€æœ‰ä¼˜åŒ–åï¼š
- **CPU ä½¿ç”¨ç‡**: é™ä½ 60-70%
- **GPU ä½¿ç”¨ç‡**: é™ä½ 40-50%
- **ç”µæ± æ¶ˆè€—**: é™ä½ 50-60%
- **å‘çƒ­**: æ˜¾è‘—æ”¹å–„
- **æµç•…åº¦**: æ˜æ˜¾æå‡

---

## ğŸ› ï¸ å®æ–½è®¡åˆ’

### Phase 1: ç´§æ€¥ä¿®å¤ï¼ˆä»Šå¤©ï¼‰
- [ ] é™ä½æ‰€æœ‰ Timer é¢‘ç‡
- [ ] å‡å°‘ MapKit è¯·æ±‚
- [ ] é™ä½ GPS ç²¾åº¦

### Phase 2: é‡è¦ä¼˜åŒ–ï¼ˆæ˜å¤©ï¼‰
- [ ] ç®€åŒ–å¤©æ°”åŠ¨ç”»
- [ ] ä¼˜åŒ–åœ°å›¾æ›´æ–°
- [ ] å‡å°‘ Material ä½¿ç”¨

### Phase 3: é•¿æœŸä¼˜åŒ–ï¼ˆæœ¬å‘¨ï¼‰
- [ ] å®ç°ç¼“å­˜æœºåˆ¶
- [ ] ä¼˜åŒ–åŠ¨ç”»ç³»ç»Ÿ
- [ ] å®ç°æ‡’åŠ è½½

---

ç”Ÿæˆæ—¶é—´: 2026-02-11
